<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Play Japanese Games!</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cannon.js/0.6.2/cannon.min.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .backface-hidden { backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }
        .perspective-1000 { perspective: 1000px; }
        .shadow-purple-201 { box-shadow: 0 4px 6px -1px rgb(162 0 255 / 0.1), 0 2px 4px -2px rgb(148 0 255 / 0.1); }
        .shadow-emerald-200 { box-shadow: 0 4px 6px -1px rgb(5 150 105 / 0.1), 0 2px 4px -2px rgb(5 150 105 / 0.1); }
        .shadow-amber-200 { box-shadow: 0 4px 6px -1px rgb(251 191 36 / 0.1), 0 2px 4px -2px rgb(251 191 36 / 0.1); }
        .shadow-blue-200 { box-shadow: 0 4px 6px -1px rgb(59 130 246 / 0.1), 0 2px 4px -2px rgb(59 130 246 / 0.1); }
        
        /* Custom icons for the buttons */
        .icon {
            display: inline-block;
            width: 3rem;
            height: 3rem;
        }

        /* lucide-react icons converted to SVG for vanilla JS */
        .mic-icon {
            color: #d8b4fe; /* purple-300 */
        }
        .book-open-icon {
            color: #34d399; /* emerald-400 */
        }
        .graduation-cap-icon {
            color: #60a5fa; /* blue-400 */
        }
        .chevron-left-icon {
            color: #d1d5db; /* gray-300 */
        }
        .text-purple-300 { color: #d8b4fe; }
        .text-emerald-400 { color: #34d399; }
        .text-amber-400 { color: #fbbf24; }
        .text-blue-400 { color: #60a5fa; }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex flex-col items-center">

    <!-- Homepage Section -->
    <div id="homepage" class="page-section p-6 sm:p-12 h-full w-full">
        <div class="flex flex-col items-center justify-center min-h-screen">
            <h1 class="text-4xl sm:text-6xl font-extrabold text-blue-400 mb-8 sm:mb-12 text-center drop-shadow-md">
                Play Japanese Games!
            </h1>
            <p class="text-lg sm:text-xl text-gray-400 mb-10 text-center max-w-2xl">
                Choose a game to start playing.
            </p>
            <div id="card-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 gap-6 w-full max-w-5xl">
                <!-- Card for Katakana/Hiragana -->
                <div class="p-6 bg-gray-800 rounded-2xl border-2 cursor-pointer transition-all duration-300 transform hover:scale-105 hover:shadow-xl bg-purple-800 border-purple-500 hover:bg-purple-700 shadow-purple-201 flex flex-col justify-between" onclick="showMessage('Katakana/Hiragana game is not yet implemented.')">
                    <div class="flex items-center justify-center mb-4">
                        <div class="p-4 rounded-full bg-purple-800">
                            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon text-purple-300"><path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="22"></line></svg>
                        </div>
                    </div>
                    <h3 class="text-xl font-bold text-white mb-2 text-center">Katakana/Hiragana</h3>
                    <p class="text-gray-400 text-center text-sm">Practice your syllabaries.</p>
                </div>
                <!-- Card for Kanji -->
                <div class="p-6 bg-gray-800 rounded-2xl border-2 cursor-pointer transition-all duration-300 transform hover:scale-105 hover:shadow-xl bg-emerald-800 border-emerald-500 hover:bg-emerald-700 shadow-emerald-200 flex flex-col justify-between" onclick="showMessage('Kanji game is not yet implemented.')">
                    <div class="flex items-center justify-center mb-4">
                        <div class="p-4 rounded-full bg-emerald-800">
                            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon text-emerald-400"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg>
                        </div>
                    </div>
                    <h3 class="text-xl font-bold text-white mb-2 text-center">Kanji</h3>
                    <p class="text-gray-400 text-center text-sm">Test your knowledge of Kanji characters.</p>
                </div>
                <!-- Card for Reading Excercise -->
                <div class="p-6 bg-gray-800 rounded-2xl border-2 cursor-pointer transition-all duration-300 transform hover:scale-105 hover:shadow-xl bg-amber-800 border-amber-500 hover:bg-amber-700 shadow-amber-200 flex flex-col justify-between" onclick="showMessage('Reading Excercise game is not yet implemented.')">
                    <div class="flex items-center justify-center mb-4">
                        <div class="p-4 rounded-full bg-amber-800">
                            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon text-amber-400"><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"></path></svg>
                        </div>
                    </div>
                    <h3 class="text-xl font-bold text-white mb-2 text-center">Reading Excercise</h3>
                    <p class="text-gray-400 text-center text-sm">Improve your reading comprehension.</p>
                </div>
                <!-- Card for Pachinko -->
                <div class="p-6 bg-gray-800 rounded-2xl border-2 cursor-pointer transition-all duration-300 transform hover:scale-105 hover:shadow-xl bg-blue-800 border-blue-500 hover:bg-blue-700 shadow-blue-200 flex flex-col justify-between" onclick="showPachinko()">
                    <div class="flex items-center justify-center mb-4">
                        <div class="p-4 rounded-full bg-blue-800">
                            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon text-blue-400"><path d="M22 10.5V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h6.5"></path><path d="M19 16v6"></path><path d="M22 19h-6"></path><path d="M7 2a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h3a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H7z"></path></svg>
                        </div>
                    </div>
                    <h3 class="text-xl font-bold text-white mb-2 text-center">Pachinko</h3>
                    <p class="text-gray-400 text-center text-sm">A fun 3D physics-based game.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Pachinko Game Section -->
    <div id="pachinko-game" class="page-section hidden flex-grow p-6 w-full">
        <div class="flex flex-col items-center justify-start h-full">
            <div class="flex items-center justify-between p-4 sm:p-6 bg-gray-900 border-b-2 border-gray-700 drop-shadow-sm sticky top-0 z-50 w-full">
                <button
                    onclick="showHomepage()"
                    class="p-2 rounded-full bg-gray-700 hover:bg-gray-600 transition-colors duration-200"
                    aria-label="Go back to homepage"
                >
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="chevron-left-icon"><path d="m15 18-6-6 6-6"/></svg>
                </button>
                <h2 class="text-xl sm:text-2xl font-bold text-white">Pachinko</h2>
                <div class="w-8 h-8"></div>
            </div>
            <div class="flex flex-col items-center justify-center flex-grow p-6 w-full">
                <p class="text-xl text-gray-400 mb-6">Score: <span id="score">0</span></p>
                <div class="relative w-full max-w-2xl aspect-[16/9] bg-gray-800 rounded-3xl overflow-hidden shadow-2xl border-4 border-gray-700">
                    <canvas id="pachinko-canvas" class="w-full h-full block"></canvas>
                </div>
                <div id="message-box" class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white text-gray-900 px-6 py-3 rounded-full text-xl font-bold animate-pulse shadow-xl z-10 hidden"></div>
                <button
                    id="drop-ball-button"
                    onclick="dropBall()"
                    class="mt-8 px-8 py-4 text-2xl font-bold rounded-full transition-all duration-300 transform shadow-lg bg-emerald-500 hover:bg-emerald-600 hover:scale-105"
                >
                    Drop Ball
                </button>
            </div>
        </div>
    </div>

    <script>
        const homepageEl = document.getElementById('homepage');
        const pachinkoGameEl = document.getElementById('pachinko-game');
        const scoreEl = document.getElementById('score');
        const messageBoxEl = document.getElementById('message-box');
        const dropBallButton = document.getElementById('drop-ball-button');
        const canvas = document.getElementById('pachinko-canvas');

        let currentPage = 'home';
        let score = 0;
        let isDropping = false;

        // Three.js and Cannon.js variables
        let scene, camera, renderer;
        let world;
        let balls = [];
        let pins = [];
        let animationId;
        let scriptsLoaded = false;

        // Function to show a message on screen
        const showMessage = (msg) => {
            messageBoxEl.textContent = msg;
            messageBoxEl.classList.remove('hidden');
            setTimeout(() => {
                messageBoxEl.classList.add('hidden');
            }, 3000);
        };

        // Function to show the homepage and hide other pages
        const showHomepage = () => {
            homepageEl.classList.remove('hidden');
            pachinkoGameEl.classList.add('hidden');
            currentPage = 'home';
            // Stop the animation loop and clean up game elements
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }
        };

        // Function to show the Pachinko game
        const showPachinko = () => {
            homepageEl.classList.add('hidden');
            pachinkoGameEl.classList.remove('hidden');
            currentPage = 'pachinko';
            
            // Only initialize the game once the page is shown
            if (!scriptsLoaded) {
                // The scripts are already loaded via the head, so we just need to initialize
                initGame();
                scriptsLoaded = true;
            } else {
                // If the game was already initialized, restart the animation loop
                animate();
            }
        };

        const initGame = () => {
            // Initialize Three.js scene
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 20;
            camera.position.y = 15;
            camera.lookAt(0, 5, 0);

            renderer = new THREE.WebGLRenderer({ canvas: canvas, antialias: true });
            renderer.setSize(canvas.clientWidth, canvas.clientHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            renderer.setClearColor(0x1a202c);

            const ambientLight = new THREE.AmbientLight(0x404040);
            scene.add(ambientLight);
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(0, 30, 20);
            directionalLight.castShadow = true;
            directionalLight.shadow.mapSize.width = 1024;
            directionalLight.shadow.mapSize.height = 1024;
            directionalLight.shadow.camera.near = 0.5;
            directionalLight.shadow.camera.far = 50;
            scene.add(directionalLight);

            // Initialize Cannon.js world
            world = new CANNON.World();
            world.gravity.set(0, -9.82, 0);
            world.broadphase = new CANNON.NaiveBroadphase();
            world.solver.iterations = 10;

            // Create ground plane
            const groundShape = new CANNON.Plane();
            const groundBody = new CANNON.Body({ mass: 0, shape: groundShape });
            groundBody.quaternion.setFromAxisAngle(new CANNON.Vec3(1, 0, 0), -Math.PI / 2);
            world.addBody(groundBody);
            const groundMesh = new THREE.Mesh(
                new THREE.PlaneGeometry(100, 100),
                new THREE.MeshStandardMaterial({ color: 0x38a169 })
            );
            groundMesh.rotation.x = -Math.PI / 2;
            groundMesh.receiveShadow = true;
            scene.add(groundMesh);

            // Create pins
            const pinGeometry = new THREE.CylinderGeometry(0.3, 0.3, 2, 32);
            const pinMaterial = new THREE.MeshStandardMaterial({ color: 0xcccccc });
            const pinShape = new CANNON.Cylinder(0.3, 0.3, 2, 32);
            const rows = 12;
            const spacing = 2;
            for (let i = 0; i < rows; i++) {
                const rowPins = i + 1;
                const rowOffset = (rowPins - 1) * spacing / 2;
                for (let j = 0; j < rowPins; j++) {
                    const pinBody = new CANNON.Body({ mass: 0, shape: pinShape });
                    pinBody.position.set(-rowOffset + j * spacing, 1, i * spacing - 10);
                    world.addBody(pinBody);
                    
                    const pinMesh = new THREE.Mesh(pinGeometry, pinMaterial);
                    pinMesh.position.copy(pinBody.position);
                    pinMesh.castShadow = true;
                    scene.add(pinMesh);

                    pins.push({ body: pinBody, mesh: pinMesh });
                }
            }

            // Create goal areas
            const goalAreas = [
                { score: 50, color: 0xffa500, position: -6 },
                { score: 10, color: 0x90EE90, position: -2 },
                { score: 100, color: 0xff4500, position: 2 },
                { score: 50, color: 0xffa500, position: 6 },
            ];
            goalAreas.forEach(goal => {
                const goalMesh = new THREE.Mesh(
                    new THREE.BoxGeometry(4, 1, 1),
                    new THREE.MeshStandardMaterial({ color: goal.color })
                );
                goalMesh.position.set(goal.position, 0.5, 12);
                goalMesh.receiveShadow = true;
                scene.add(goalMesh);

                const goalBody = new CANNON.Body({ mass: 0, isTrigger: true });
                const goalShape = new CANNON.Box(new CANNON.Vec3(2, 0.5, 0.5));
                goalBody.addShape(goalShape);
                goalBody.position.set(goal.position, 0.5, 12);
                world.addBody(goalBody);

                goalBody.addEventListener('collide', (e) => {
                    // Check if the colliding body is a ball
                    const collidingBallIndex = balls.findIndex(b => b.body === e.body);
                    if (collidingBallIndex !== -1) {
                        score += goal.score;
                        scoreEl.textContent = score;
                        showMessage(`+${goal.score} points!`);
                        
                        const ballMesh = balls[collidingBallIndex].mesh;
                        if (ballMesh) scene.remove(ballMesh);
                        world.removeBody(e.body);
                        
                        balls.splice(collidingBallIndex, 1);
                        isDropping = false;
                        dropBallButton.disabled = false;
                        dropBallButton.textContent = 'Drop Ball';
                        dropBallButton.classList.remove('bg-gray-600', 'cursor-not-allowed');
                        dropBallButton.classList.add('bg-emerald-500', 'hover:bg-emerald-600', 'hover:scale-105');
                    }
                });
            });

            // Handle window resizing
            const handleResize = () => {
                camera.aspect = canvas.clientWidth / canvas.clientHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(canvas.clientWidth, canvas.clientHeight);
            };
            window.addEventListener('resize', handleResize);

            // Start the animation loop
            animate();
        };

        const animate = () => {
            animationId = requestAnimationFrame(animate);
            if (world) {
                world.step(1/60);
            }

            balls.forEach(ball => {
                if (ball.mesh && ball.body) {
                    ball.mesh.position.copy(ball.body.position);
                    ball.mesh.quaternion.copy(ball.body.quaternion);
                }
            });

            pins.forEach(pin => {
                if (pin.mesh && pin.body) {
                    pin.mesh.position.copy(pin.body.position);
                    pin.mesh.quaternion.copy(pin.body.quaternion);
                }
            });
            
            if (renderer && scene && camera) {
                renderer.render(scene, camera);
            }
        };

        const dropBall = () => {
            if (isDropping) return;
            isDropping = true;
            dropBallButton.disabled = true;
            dropBallButton.textContent = 'Ball is in play...';
            dropBallButton.classList.remove('bg-emerald-500', 'hover:bg-emerald-600', 'hover:scale-105');
            dropBallButton.classList.add('bg-gray-600', 'cursor-not-allowed');

            const ballRadius = 0.5;
            const ballGeometry = new THREE.SphereGeometry(ballRadius, 32, 32);
            const ballMaterial = new THREE.MeshStandardMaterial({ color: 0xffffff });
            const ballMesh = new THREE.Mesh(ballGeometry, ballMaterial);
            ballMesh.castShadow = true;
            
            const ballShape = new CANNON.Sphere(ballRadius);
            const ballBody = new CANNON.Body({ mass: 1, shape: ballShape });
            ballBody.position.set(0, 15, -10);
            
            ballBody.pachinkoMesh = ballMesh;
            
            scene.add(ballMesh);
            world.addBody(ballBody);
            
            balls.push({ mesh: ballMesh, body: ballBody });
        };
        
        // Initially show the homepage
        document.addEventListener('DOMContentLoaded', () => {
            showHomepage();
        });
    </script>
</body>
</html>
